# QA Protocol: Flight Manual

**Objective:** Safe startup, monitoring, and shutdown of the HiDock Next Electron application for automated quality assessment.

---

## 1. Safety & Process Management

### ðŸ›‘ KILL SWITCH RULES
*   **NEVER** run `taskkill /F /IM electron.exe` or `node.exe` without `/PID`.
*   **REASON:** This kills the agent's own shell/environment.
*   **CORRECT PROCEDURE:**
    1.  Call `get_electron_window_info` to find running targets.
    2.  If the port is blocked but no window is found, use `netstat -ano | findstr :9222`.
    3.  Kill **ONLY** the specific PID found: `taskkill /F /PID <PID>`.

### Log Management
*   **Main Process Log:** `electron_app_qa.log` (Redirected Stdout/Stderr).
*   **Renderer Log:** `apps/electron/localhost-*.log` (Generated by `qa-monitor.ts`).
*   **Action:** Before every session, verify these files are being written to.

---

## 2. Launch Procedure

To start the application with **QA Monitoring** and **Remote Debugging** enabled:

1.  **Check Port:** Ensure port `9222` is free.
2.  **Execute Command:**
    ```powershell
    Start-Process -FilePath 'cmd.exe' -ArgumentList '/c run-electron.bat > electron_app_qa.log 2>&1' -WindowStyle Minimized
    ```
3.  **Wait:** Allow 10-15 seconds for:
    *   Vite Server spin-up.
    *   Electron Main process initialization.
    *   DevTools listening on port 9222.
4.  **Verify:** Call `get_electron_window_info`. If `automationReady: true`, proceed.

---

## 3. Monitoring Tools ("The Cockpit")

### `read_electron_logs`
*   **Use:** To read the *Console* output from the renderer (React/Browser).
*   **Target:** `[QA-MONITOR]` tags.
*   **Alerts:** `[IPC-ERR]`, `TypeError`, `Uncaught Error`.

### `send_command_to_electron`
*   **Use:** To simulate user clicks when valid CSS selectors are known.
*   **Commands:** `click_by_selector`, `get_page_structure`.

### `take_screenshot`
*   **Use:** Visual verification of state changes (e.g., "Did the modal open?").

---

## 4. Emergency Recovery
If the app hangs or logs flood:
1.  **Stop Monitoring:** Do not issue more read commands.
2.  **Identify PID:** Find the specific Electron PID consuming CPU.
3.  **Surgical Kill:** `taskkill /F /PID <PID>`.
4.  **Archive Log:** Rename `electron_app_qa.log` to `electron_app_qa_<timestamp>.log`.

---

## 5. Automation Pitfalls & Best Practices

### Navigation Verification
*   **Pitfall:** `click_by_text` may return "success" even if the application's React router cancels the event or navigation fails silently.
*   **Mandate:** **ALWAYS** verify navigation by calling `get_url` or evaluating `window.location.hash` before proceeding to the next step or taking a screenshot.

### State Settlement
*   **Pitfall:** Taking a screenshot immediately after a "success" response from a click command often captures a "Loading" or intermediate state.
*   **Mandate:** Wait for a specific log entry (e.g., `[QA-MONITOR] Navigation: -> /route`) or use a brief delay to allow the DOM to settle.

### Thread-Blocking Dialogs
*   **Pitfall:** Native browser methods like `window.prompt()`, `alert()`, and `confirm()` block the Electron renderer thread and are invisible to automation tools.
*   **Mandate:** If a test hangs indefinitely, check the code for native dialog usage. These must be refactored to custom UI modals for automated QA compatibility.

### Unique Visual Evidence
*   **Pitfall:** Repeated screenshots of the same page labeled as different screens due to failed navigation verification.
*   **Mandate:** Log the verified URL alongside every captured screenshot in the session report.
